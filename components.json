{
  "defaultTemplateVars": {
    "env": "local",
    "tag": "dev",
    "local": "local",
    "libs-dir": "src/libs",
    "models-deployment": "models-api-deployment",
    "models-image": "tapis/models-api",
    "datasets-deployment": "datasets-api-deployment",
    "datasets-image": "tapis/datasets-api",
    "inference-deployment": "inference-api-deployment",
    "inference-image": "tapis/inference-api",
    "training-deployment": "training-api-deployment",
    "training-image": "tapis/training-api",
    "nfs-deployment": "mlhub-nfs-server-deployment",
    "postgres-deployment": "mlhub-postgres-deployment",
    "postgres-image": "postgres",
    "postgres-image-version": "15",
    "traefik-deployment": "traefik-deployment"
  },
  "components": [
    {
      "name": "models",
      "rootDir": "src/apis/models",
      "labels": ["api"],
      "commands": {
        "initialize": "chmod -R +x {{ self.rootDir }}/scripts && {{ self.commands.buildl }} && {{ self.commands.start }}",
        "start": "{{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "stop": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}",
        "install": "cargo install --path {{ self.rootDir }}",
        "add": "cargo add --manifest-path {{ self.rootDir }}/Cargo.toml",
        "restart": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}; {{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "build": "docker build -f {{ self.rootDir }}/Dockerfile.{{ env }} -t {{ {{ self.name }}-image }}:{{ tag }} --build-arg SERVICE_NAME={{ self.name }} --build-arg SERVICE_DIR=\"{{ self.rootDir }}\" --build-arg LIBS_DIR=\"{{ libs-dir }}\" .",
        "buildl": "docker build -f {{ self.rootDir }}/Dockerfile.local -t {{ {{ self.name }}-image }}:{{ local }} --build-arg SERVICE_NAME={{ self.name }} --build-arg SERVICE_DIR=\"{{ self.rootDir }}\" --build-arg LIBS_DIR=\"{{ libs-dir }}\" . && minikube image load {{ {{ self.name }}-image }}:{{ local }}",
        "buildp": "{{ self.commands.build }} && {{ self.commands.push }}",
        "cycle": "./manage stop {{ self.name }} && ./manage buildp {{ self.name }} && ./manage start {{ self.name }}",
        "cyclel": "{{ self.commands.stop }} && {{ self.commands.buildl }} && {{ self.commands.start }}",
        "push": "docker push {{ {{ self.name }}-image }}:{{ tag }}",
        "pusht": "docker push --all-tags {{ {{ self.name }}-image }}",
        "test": "cargo test --manifest-path {{ self.rootDir }}/Cargo.toml",
        "logs": "kubectl logs deployment/{{ {{ self.name }}-deployment }}",
        "watch": "kubectl logs deployment/{{ {{ self.name }}-deployment }} -f",
        "exec": "kubectl exec -it deployment/{{ {{ self.name }}-deployment }} -- bash",
        "code": "code {{ self.rootDir }}"
      },
      "dependencies": [
        "traefik"
      ]
    },
    {
      "name": "datasets",
      "rootDir": "src/apis/datasets",
      "labels": ["api"],
      "commands": {
        "initialize": "chmod -R +x {{ self.rootDir }}/scripts && {{ self.commands.buildl }} && {{ self.commands.start }}",
        "start": "{{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "stop": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}",
        "install": "cargo install --path {{ self.rootDir }}",
        "add": "cargo add --manifest-path {{ self.rootDir }}/Cargo.toml",
        "restart": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}; {{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "build": "docker build -f {{ self.rootDir }}/Dockerfile.{{ env }} -t {{ {{ self.name }}-image }}:{{ tag }} --build-arg SERVICE_NAME={{ self.name }} --build-arg SERVICE_DIR=\"{{ self.rootDir }}\" --build-arg LIBS_DIR=\"{{ libs-dir }}\" .",
        "buildl": "docker build -f {{ self.rootDir }}/Dockerfile.local -t {{ {{ self.name }}-image }}:{{ local }} --build-arg SERVICE_NAME={{ self.name }} --build-arg SERVICE_DIR=\"{{ self.rootDir }}\" --build-arg LIBS_DIR=\"{{ libs-dir }}\" . && minikube image load {{ {{ self.name }}-image }}:{{ local }}",
        "buildp": "{{ self.commands.build }} && {{ self.commands.push }}",
        "cycle": "./manage stop {{ self.name }} && ./manage buildp {{ self.name }} && ./manage start {{ self.name }}",
        "cyclel": "{{ self.commands.stop }} && {{ self.commands.buildl }} && {{ self.commands.start }}",
        "push": "docker push {{ {{ self.name }}-image }}:{{ tag }}",
        "pusht": "docker push --all-tags {{ {{ self.name }}-image }}",
        "test": "cargo test --manifest-path {{ self.rootDir }}/Cargo.toml",
        "logs": "kubectl logs deployment/{{ {{ self.name }}-deployment }}",
        "watch": "kubectl logs deployment/{{ {{ self.name }}-deployment }} -f",
        "exec": "kubectl exec -it deployment/{{ {{ self.name }}-deployment }} -- bash",
        "code": "code {{ self.rootDir }}"
      },
      "dependencies": [
        "traefik"
      ]
    },
    {
      "name": "inference",
      "rootDir": "src/apis/inference",
      "labels": ["api"],
      "commands": {
        "initialize": "chmod -R +x {{ self.rootDir }}/scripts && {{ self.commands.buildl }} && {{ self.commands.start }}",
        "start": "{{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "stop": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}",
        "install": "cargo install --path {{ self.rootDir }}",
        "add": "cargo add --manifest-path {{ self.rootDir }}/Cargo.toml",
        "restart": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}; {{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "build": "docker build -f {{ self.rootDir }}/Dockerfile.{{ env }} -t {{ {{ self.name }}-image }}:{{ tag }} --build-arg SERVICE_NAME={{ self.name }} --build-arg SERVICE_DIR=\"{{ self.rootDir }}\" --build-arg LIBS_DIR=\"{{ libs-dir }}\" .",
        "buildl": "docker build -f {{ self.rootDir }}/Dockerfile.local -t {{ {{ self.name }}-image }}:{{ local }} --build-arg SERVICE_NAME={{ self.name }} --build-arg SERVICE_DIR=\"{{ self.rootDir }}\" --build-arg LIBS_DIR=\"{{ libs-dir }}\" . && minikube image load {{ {{ self.name }}-image }}:{{ local }}",
        "buildp": "{{ self.commands.build }} && {{ self.commands.push }}",
        "cycle": "./manage stop {{ self.name }} && ./manage buildp {{ self.name }} && ./manage start {{ self.name }}",
        "cyclel": "{{ self.commands.stop }} && {{ self.commands.buildl }} && {{ self.commands.start }}",
        "push": "docker push {{ {{ self.name }}-image }}:{{ tag }}",
        "pusht": "docker push --all-tags {{ {{ self.name }}-image }}",
        "test": "cargo test --manifest-path {{ self.rootDir }}/Cargo.toml",
        "logs": "kubectl logs deployment/{{ {{ self.name }}-deployment }}",
        "watch": "kubectl logs deployment/{{ {{ self.name }}-deployment }} -f",
        "exec": "kubectl exec -it deployment/{{ {{ self.name }}-deployment }} -- bash",
        "code": "code {{ self.rootDir }}"
      },
      "dependencies": [
        "traefik",
        "nfs",
        "postgres"
      ]
    },
    {
      "name": "training",
      "rootDir": "src/apis/training",
      "labels": ["api"],
      "commands": {
        "initialize": "chmod -R +x {{ self.rootDir }}/scripts && {{ self.commands.buildl }} && {{ self.commands.start }}",
        "start": "{{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "stop": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}",
        "install": "cargo install --path {{ self.rootDir }}",
        "add": "cargo add --manifest-path {{ self.rootDir }}/Cargo.toml",
        "restart": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}; {{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "build": "docker build -f {{ self.rootDir }}/Dockerfile.{{ env }} -t {{ {{ self.name }}-image }}:{{ tag }} --build-arg SERVICE_NAME={{ self.name }} --build-arg SERVICE_DIR=\"{{ self.rootDir }}\" --build-arg LIBS_DIR=\"{{ libs-dir }}\" .",
        "buildl": "docker build -f {{ self.rootDir }}/Dockerfile.local -t {{ {{ self.name }}-image }}:{{ local }} --build-arg SERVICE_NAME={{ self.name }} --build-arg SERVICE_DIR=\"{{ self.rootDir }}\" --build-arg LIBS_DIR=\"{{ libs-dir }}\" . && minikube image load {{ {{ self.name }}-image }}:{{ local }}",
        "buildp": "{{ self.commands.build }} && {{ self.commands.push }}",
        "cycle": "./manage stop {{ self.name }} && ./manage buildp {{ self.name }} && ./manage start {{ self.name }}",
        "cyclel": "{{ self.commands.stop }} && {{ self.commands.buildl }} && {{ self.commands.start }}",
        "push": "docker push {{ {{ self.name }}-image }}:{{ tag }}",
        "pusht": "docker push --all-tags {{ {{ self.name }}-image }}",
        "test": "cargo test --manifest-path {{ self.rootDir }}/Cargo.toml",
        "logs": "kubectl logs deployment/{{ {{ self.name }}-deployment }}",
        "watch": "kubectl logs deployment/{{ {{ self.name }}-deployment }} -f",
        "exec": "kubectl exec -it deployment/{{ {{ self.name }}-deployment }} -- bash",
        "code": "code {{ self.rootDir }}"
      },
      "dependencies": [
        "traefik",
        "nfs",
        "postgres"
      ]
    },
    {
      "name": "nfs",
      "rootDir": "src/components/nfs",
      "labels": ["component"],
      "commands": {
        "initialize": "chmod -R +x {{ self.rootDir }}/scripts",
        "start": "{{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "stop": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}",
        "restart": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}; {{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "logs": "kubectl logs deployment/{{ {{ self.name }}-deployment }}",
        "watch": "kubectl logs deployment/{{ {{ self.name }}-deployment }} -f",
        "exec": "kubectl exec -it deployment/{{ {{ self.name }}-deployment }} --container=\"nfs-server\" -- sh"
      }
    },
    {
      "name": "traefik",
      "rootDir": "src/components/traefik",
      "labels": ["component"],
      "commands": {
        "initialize": "chmod -R +x {{ self.rootDir }}/scripts",
        "start": "{{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "stop": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}",
        "restart": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}; {{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "logs": "kubectl logs deployment/{{ {{ self.name }}-deployment }}",
        "watch": "kubectl logs deployment/{{ {{ self.name }}-deployment }} -f",
        "exec": "kubectl exec -it deployment/{{ {{ self.name }}-deployment }} -- sh",
        "expose": "minikube service expose traefik-web-service --url",
        "code": "code src/components/{{ self.name }}"
      }
    },
    {
      "name": "postgres",
      "rootDir": "src/components/postgres",
      "labels": ["component"],
      "commands": {
        "initialize": "chmod -R +x {{ self.rootDir }}/scripts",
        "start": "{{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "stop": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}",
        "restart": "{{ self.rootDir }}/scripts/burndown.sh {{ self.rootDir }}; {{ self.rootDir }}/scripts/burnup.sh {{ self.rootDir }}",
        "logs": "kubectl logs deployment/{{ {{ self.name }}-deployment }}",
        "watch": "kubectl logs deployment/{{ {{ self.name }}-deployment }} -f",
        "exec": "kubectl exec -it deployment/{{ {{ self.name }}-deployment }} -- sh"
      }
    },
    {
      "name": "huggingface-client",
      "rootDir": "src/libs/huggingface-client",
      "labels": ["lib"],
      "commands": {
        "initialize": "",
        "compile": "cargo build --manifest-path src/libs/{{ self.name }}/Cargo.toml",
        "add": "cargo add --manifest-path {{ self.rootDir }}/Cargo.toml",
        "code": "code src/libs/{{ self.name }}"
      }
    },
    {
      "name": "shared",
      "rootDir": "src/libs/shared",
      "labels": ["lib"],
      "commands": {
        "initialize": "",
        "compile": "cargo build --manifest-path src/libs/{{ self.name }}/Cargo.toml",
        "add": "cargo add --manifest-path {{ self.rootDir }}/Cargo.toml",
        "remove": "cargo remove --manifest-path {{ self.rootDir }}/Cargo.toml",
        "code": "code src/libs/{{ self.name }}"
      }
    },
    {
      "name": "clients",
      "rootDir": "src/libs/clients",
      "labels": ["lib"],
      "commands": {
        "initialize": "",
        "compile": "cargo build --manifest-path src/libs/{{ self.name }}/Cargo.toml",
        "add": "cargo add --manifest-path {{ self.rootDir }}/Cargo.toml",
        "remove": "cargo remove --manifest-path {{ self.rootDir }}/Cargo.toml",
        "code": "code src/libs/{{ self.name }}"
      }
    }
  ]
}